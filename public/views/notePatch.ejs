<%- include('partials/head') %>
<body>
    <%- include('partials/navbar') %>
    <div class="container primary-wrapper">
        <%- include('partials/flashMessage') %>

        <div class="note-form" data-id="<%= note._id %>">
            <form id="note-form">
                <%- include('partials/form_fields', {note}) %>
            </form>
        </div>  
    </div>

    <script>
        const cancelBtn = document.getElementById('cancel-btn')
        const saveBtn = document.getElementById('save-btn')
        const title = document.getElementById('title')
        const id = document.querySelector('.note-form').dataset.id
        const form = document.getElementById('note-form')


        window.addEventListener('load', function(){
            title.disabled = true
        })
        
        cancelBtn.addEventListener('click', function(e){
            e.preventDefault()
            location.assign(`/api/note/${id}`)
        })

        saveBtn.addEventListener('click', async function(e){
            e.preventDefault()
            saveBtn.disabled = true
            try {
            let note = form.note.value
            await fetch(`/api/note/u/${id}`, {
                method: "PATCH",
                body: JSON.stringify({note}),
                headers: { "Content-Type": "application/json" }
            })
             
            setTimeout(() => location.assign(`/api/note/${id}`), 500) 
            }
            catch (error){
                console.log(error)
            }
        })
    </script>
</body>
</html>